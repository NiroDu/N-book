<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>è®²è®² Redux createStore çš„å®ç°åŸç† | N-book</title>
    <meta name="description" content="è®°å½•ä¸€äº›æŠ€æœ¯æ–¹é¢çš„æ–‡ç« ">
    <link rel="icon" href="/n-book/logo.png">
  <link rel="manifest" href="/n-book/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/n-book/assets/css/0.styles.8647af70.css" as="style"><link rel="preload" href="/n-book/assets/js/app.00669d2d.js" as="script"><link rel="preload" href="/n-book/assets/js/24.9323b659.js" as="script"><link rel="prefetch" href="/n-book/assets/js/10.66c97b87.js"><link rel="prefetch" href="/n-book/assets/js/100.25cd6efd.js"><link rel="prefetch" href="/n-book/assets/js/11.d97ba4f9.js"><link rel="prefetch" href="/n-book/assets/js/12.8a7fa5f8.js"><link rel="prefetch" href="/n-book/assets/js/13.5c6c1dfb.js"><link rel="prefetch" href="/n-book/assets/js/14.c5caa02e.js"><link rel="prefetch" href="/n-book/assets/js/15.6bba582a.js"><link rel="prefetch" href="/n-book/assets/js/16.15881af1.js"><link rel="prefetch" href="/n-book/assets/js/17.58f3bf6d.js"><link rel="prefetch" href="/n-book/assets/js/18.41a59aa0.js"><link rel="prefetch" href="/n-book/assets/js/19.372839fc.js"><link rel="prefetch" href="/n-book/assets/js/20.366470b6.js"><link rel="prefetch" href="/n-book/assets/js/21.64ee41da.js"><link rel="prefetch" href="/n-book/assets/js/22.037051e6.js"><link rel="prefetch" href="/n-book/assets/js/23.aaf071e1.js"><link rel="prefetch" href="/n-book/assets/js/25.efd078a6.js"><link rel="prefetch" href="/n-book/assets/js/26.e088dd56.js"><link rel="prefetch" href="/n-book/assets/js/27.23686290.js"><link rel="prefetch" href="/n-book/assets/js/28.7561d341.js"><link rel="prefetch" href="/n-book/assets/js/29.c2bccad7.js"><link rel="prefetch" href="/n-book/assets/js/3.a2cc91fe.js"><link rel="prefetch" href="/n-book/assets/js/30.e41777e5.js"><link rel="prefetch" href="/n-book/assets/js/31.8fa8342a.js"><link rel="prefetch" href="/n-book/assets/js/32.4a720fec.js"><link rel="prefetch" href="/n-book/assets/js/33.f4bcb093.js"><link rel="prefetch" href="/n-book/assets/js/34.b319e6cc.js"><link rel="prefetch" href="/n-book/assets/js/35.349f48cb.js"><link rel="prefetch" href="/n-book/assets/js/36.40f0f5b8.js"><link rel="prefetch" href="/n-book/assets/js/37.d825f129.js"><link rel="prefetch" href="/n-book/assets/js/38.03ef6cd3.js"><link rel="prefetch" href="/n-book/assets/js/39.5616fe5e.js"><link rel="prefetch" href="/n-book/assets/js/4.5c88fff9.js"><link rel="prefetch" href="/n-book/assets/js/40.06b60369.js"><link rel="prefetch" href="/n-book/assets/js/41.c8f4431f.js"><link rel="prefetch" href="/n-book/assets/js/42.611e129f.js"><link rel="prefetch" href="/n-book/assets/js/43.090fb933.js"><link rel="prefetch" href="/n-book/assets/js/44.95113469.js"><link rel="prefetch" href="/n-book/assets/js/45.7fd92109.js"><link rel="prefetch" href="/n-book/assets/js/46.411b0cb5.js"><link rel="prefetch" href="/n-book/assets/js/47.c4ed96a6.js"><link rel="prefetch" href="/n-book/assets/js/48.363d6e9d.js"><link rel="prefetch" href="/n-book/assets/js/49.a6580a6f.js"><link rel="prefetch" href="/n-book/assets/js/5.7ed2b6ce.js"><link rel="prefetch" href="/n-book/assets/js/50.80fdc641.js"><link rel="prefetch" href="/n-book/assets/js/51.9fca5b30.js"><link rel="prefetch" href="/n-book/assets/js/52.7a12bef7.js"><link rel="prefetch" href="/n-book/assets/js/53.0a0223c1.js"><link rel="prefetch" href="/n-book/assets/js/54.f5e1f5f6.js"><link rel="prefetch" href="/n-book/assets/js/55.3942d1de.js"><link rel="prefetch" href="/n-book/assets/js/56.6edb51e4.js"><link rel="prefetch" href="/n-book/assets/js/57.ea4bffdf.js"><link rel="prefetch" href="/n-book/assets/js/58.e7e0ee95.js"><link rel="prefetch" href="/n-book/assets/js/59.4098f04a.js"><link rel="prefetch" href="/n-book/assets/js/6.b2aebbbe.js"><link rel="prefetch" href="/n-book/assets/js/60.db12ab5e.js"><link rel="prefetch" href="/n-book/assets/js/61.031fb8bd.js"><link rel="prefetch" href="/n-book/assets/js/62.329f47c4.js"><link rel="prefetch" href="/n-book/assets/js/63.b2f2abcc.js"><link rel="prefetch" href="/n-book/assets/js/64.dc588d61.js"><link rel="prefetch" href="/n-book/assets/js/65.d599496d.js"><link rel="prefetch" href="/n-book/assets/js/66.69417e8c.js"><link rel="prefetch" href="/n-book/assets/js/67.d93755f8.js"><link rel="prefetch" href="/n-book/assets/js/68.f25092ea.js"><link rel="prefetch" href="/n-book/assets/js/69.2de4fe7c.js"><link rel="prefetch" href="/n-book/assets/js/7.157f3540.js"><link rel="prefetch" href="/n-book/assets/js/70.282e9d03.js"><link rel="prefetch" href="/n-book/assets/js/71.504f689e.js"><link rel="prefetch" href="/n-book/assets/js/72.a2d94f4f.js"><link rel="prefetch" href="/n-book/assets/js/73.07c4c964.js"><link rel="prefetch" href="/n-book/assets/js/74.89c222e9.js"><link rel="prefetch" href="/n-book/assets/js/75.820bdfb7.js"><link rel="prefetch" href="/n-book/assets/js/76.2407d5c9.js"><link rel="prefetch" href="/n-book/assets/js/77.ec939a5f.js"><link rel="prefetch" href="/n-book/assets/js/78.07709c00.js"><link rel="prefetch" href="/n-book/assets/js/79.cc7a4faa.js"><link rel="prefetch" href="/n-book/assets/js/8.c2fc7b68.js"><link rel="prefetch" href="/n-book/assets/js/80.fd9ef1eb.js"><link rel="prefetch" href="/n-book/assets/js/81.df45910d.js"><link rel="prefetch" href="/n-book/assets/js/82.450bb3f2.js"><link rel="prefetch" href="/n-book/assets/js/83.32c188fc.js"><link rel="prefetch" href="/n-book/assets/js/84.294bd5d9.js"><link rel="prefetch" href="/n-book/assets/js/85.6de4096a.js"><link rel="prefetch" href="/n-book/assets/js/86.0954b5d1.js"><link rel="prefetch" href="/n-book/assets/js/87.e7762817.js"><link rel="prefetch" href="/n-book/assets/js/88.97035a60.js"><link rel="prefetch" href="/n-book/assets/js/89.53a151f5.js"><link rel="prefetch" href="/n-book/assets/js/9.e94df2f4.js"><link rel="prefetch" href="/n-book/assets/js/90.a6f97b09.js"><link rel="prefetch" href="/n-book/assets/js/91.22f24c28.js"><link rel="prefetch" href="/n-book/assets/js/92.75844e0d.js"><link rel="prefetch" href="/n-book/assets/js/93.d6922f54.js"><link rel="prefetch" href="/n-book/assets/js/94.3dd08f5f.js"><link rel="prefetch" href="/n-book/assets/js/95.6a4c80ba.js"><link rel="prefetch" href="/n-book/assets/js/96.c25099ac.js"><link rel="prefetch" href="/n-book/assets/js/97.1e5183d7.js"><link rel="prefetch" href="/n-book/assets/js/98.bbdf3f45.js"><link rel="prefetch" href="/n-book/assets/js/99.a020358d.js"><link rel="prefetch" href="/n-book/assets/js/vendors~docsearch.8bf892cf.js">
    <link rel="stylesheet" href="/n-book/assets/css/0.styles.8647af70.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/n-book/" class="home-link router-link-active"><!----> <span class="site-name">N-book</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/n-book/" class="nav-link">Home</a></div><div class="nav-item"><a href="/n-book/typescript/" class="nav-link">TypeScript</a></div><div class="nav-item"><a href="/n-book/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="https://nirodu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/NiroDu/N-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/n-book/" class="nav-link">Home</a></div><div class="nav-item"><a href="/n-book/typescript/" class="nav-link">TypeScript</a></div><div class="nav-item"><a href="/n-book/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="https://nirodu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/NiroDu/N-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span></span> <!----></p> <ul class="sidebar-group-items"><li><a href="/n-book/" class="sidebar-link">ğŸ“–</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScriptsä¸“æ </span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>React ä¸“æ </span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/n-book/react/react_basic.html" class="sidebar-link">React åŸºç¡€éƒ¨åˆ†</a></li><li><a href="/n-book/react/redux_basic.html" class="sidebar-link">Redux åŸºç¡€éƒ¨åˆ†</a></li><li><a href="/n-book/react/redux_intermediate.html" class="sidebar-link">Redux ä¸­çº§éƒ¨åˆ†</a></li><li><a href="/n-book/react/libs_with_react.html" class="sidebar-link">Libs with React</a></li><li><a href="/n-book/react/react_ssr.html" class="sidebar-link">ä» 0 å®ç° React SSR</a></li><li><a href="/n-book/react/redux_createstore.html" class="active sidebar-link">è®²è®² Redux createStore çš„å®ç°åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/n-book/react/redux_createstore.html#åŸºæœ¬ç”¨æ³•" class="sidebar-link">åŸºæœ¬ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/n-book/react/redux_createstore.html#æºç åŠåˆ†æ" class="sidebar-link">æºç åŠåˆ†æ</a></li><li class="sidebar-sub-header"><a href="/n-book/react/redux_createstore.html#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a></li></ul></li><li><a href="/n-book/react/react_context.html" class="sidebar-link">React Context æ€ä¹ˆç”¨</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue ä¸“æ </span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Webpack ä¸“æ </span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>TypeScript ä¸“æ </span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>è‡ªåŠ¨åŒ–æµ‹è¯•</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>æ€§èƒ½ä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Interview ä¸“æ </span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>å…¶ä»–</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="è®²è®²-redux-createstore-çš„å®ç°åŸç†"><a href="#è®²è®²-redux-createstore-çš„å®ç°åŸç†" class="header-anchor">#</a> è®²è®² Redux createStore çš„å®ç°åŸç†</h1> <p><img src="/n-book/assets/img/createStore.428590eb.jpg" alt="createStore"></p> <p>createStore åˆ›å»ºä¸€ä¸ª Redux store æ¥ä»¥å­˜æ”¾åº”ç”¨ä¸­æ‰€æœ‰çš„ stateï¼Œåº”ç”¨ä¸­åº”æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª storeã€‚å…¶ä¸­æš´éœ² dispatch, subscribe, getState, replaceReducer æ–¹æ³•ã€‚</p> <h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="header-anchor">#</a> åŸºæœ¬ç”¨æ³•</h2> <p>å…ˆçœ‹çœ‹ createStore æ˜¯æ€ä¹ˆä¸ªç”¨æ³•ï¼š</p> <p><code>createStore(reducer, [preloadedState], enhancer)</code></p> <p><strong>å‚æ•°</strong></p> <p><code>reducer (Function)</code>: A reducing function that returns the next state tree, given the current state tree and an action to handle.(reducer æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å½“å‰çš„ state æ ‘å’Œè¦å¤„ç†çš„ actionï¼Œè¿”å›æ–°çš„ state æ ‘ã€‚)</p> <p><code>[preloadedState] (any)</code>: The initial state. You may optionally specify it to hydrate the state from the server in universal apps, or to restore a previously serialized user session. If you produced reducer with combineReducers, this must be a plain object with the same shape as the keys passed to it. Otherwise, you are free to pass anything that your reducer can understand.(åˆå§‹æ—¶çš„ stateã€‚åœ¨åŒæ„åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦æŠŠæœåŠ¡ç«¯ä¼ æ¥çš„ state hydrate åä¼ ç»™å®ƒï¼Œæˆ–è€…ä»ä¹‹å‰ä¿å­˜çš„ç”¨æˆ·ä¼šè¯ä¸­æ¢å¤ä¸€ä¸ªä¼ ç»™å®ƒã€‚å¦‚æœä½ ä½¿ç”¨ combineReducers åˆ›å»º reducerï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œä¸ä¼ å…¥çš„ keys ä¿æŒåŒæ ·çš„ç»“æ„ã€‚å¦åˆ™ï¼Œä½ å¯ä»¥è‡ªç”±ä¼ å…¥ä»»ä½• reducer å¯ç†è§£çš„å†…å®¹ã€‚)</p> <p><code>[enhancer] (Function)</code>: The store enhancer. You may optionally specify it to enhance the store with third-party capabilities such as middleware, time travel, persistence, etc. The only store enhancer that ships with Redux is applyMiddleware().(store çš„å¢å¼ºå™¨å‡½æ•°ï¼Œå¯ä»¥æŒ‡å®šä¸ºç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶ï¼Œæ—¶é—´æ—…è¡Œï¼ŒæŒä¹…åŒ– ç­‰ç­‰ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åªèƒ½ç”¨ Redux æä¾›çš„ applyMiddleware å‡½æ•°æ¥ç”Ÿæˆï¼›)</p> <p><strong>è¿”å›å€¼</strong></p> <p>(Store): An object that holds the complete state of your app. The only way to change its state is by dispatching actions. You may also subscribe to the changes to its state to update the UI.(ä¿å­˜äº†æ‰€æœ‰ state çš„å¯¹è±¡ã€‚æ”¹å˜ state çš„å”¯ä¸€æ–¹æ³•æ˜¯ dispatch actionã€‚ä½ ä¹Ÿå¯ä»¥ subscribe ç›‘å¬ state çš„å˜åŒ–ï¼Œç„¶åæ›´æ–° UIã€‚)</p> <p><strong>ç¤ºä¾‹</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// å£°æ˜ä¸€ä¸ªreducer</span>
<span class="token keyword">function</span> <span class="token function">todos</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;ADD_TODO&quot;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>action<span class="token punctuation">.</span>text<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;Use Redux&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">&quot;ADD_TODO&quot;</span><span class="token punctuation">,</span>
  text<span class="token punctuation">:</span> <span class="token string">&quot;Read the docs&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 'Use Redux', 'Read the docs' ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="æºç åŠåˆ†æ"><a href="#æºç åŠåˆ†æ" class="header-anchor">#</a> æºç åŠåˆ†æ</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// å¤§ä½“æ¡†æ¶</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ActionTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INIT</span><span class="token punctuation">:</span> <span class="token string">&quot;@@redux/INIT&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> preloadedState<span class="token punctuation">,</span> enhancer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...åˆå§‹æ¡ä»¶çš„åˆ¤æ–­å’Œè®¾å®š</span>
  <span class="token keyword">function</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// getStateæ–¹æ³•çš„å®ç°</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// subscribeæ–¹æ³•çš„å®ç°</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// dispatchæ–¹æ³•çš„å®ç°</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">replaceReducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// replaceReduceræ–¹æ³•çš„å®ç°</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// observableæ–¹æ³•çš„å®ç°</span>
    <span class="token comment">// (æºç ä¸­å…³äºobservableçš„éƒ¨åˆ†å¯ä»¥å¿½ç•¥ï¼Œè¿™ä¸ªæ˜¯reduxå†…éƒ¨ä½¿ç”¨çš„ã€‚æˆ‘ä»¬åœ¨å¼€å‘ä¸­å‡ ä¹å‡ ä¹ç”¨ä¸åˆ°)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// storeè¢«åˆ›å»ºåï¼Œè‡ªåŠ¨åˆ†å‘ä¸€ä¸ª'INIT' actionã€‚æ¸²æŸ“å‡ºåˆå§‹åŒ–çš„stateæ ‘ã€‚</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INIT</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    dispatch<span class="token punctuation">,</span>
    subscribe<span class="token punctuation">,</span>
    getState<span class="token punctuation">,</span>
    replaceReducer
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>å®Œæ•´æºç </strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª ActionTypes å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ª actionï¼Œæ˜¯ä¸€ä¸ª Redux çš„ç§æœ‰ actionï¼Œä¸å…è®¸å¤–ç•Œè§¦å‘ï¼Œç”¨æ¥åˆå§‹åŒ– Store çš„çŠ¶æ€æ ‘å’Œæ”¹å˜ reducers ååˆå§‹åŒ– Store çš„çŠ¶æ€æ ‘ã€‚</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ActionTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INIT</span><span class="token punctuation">:</span> <span class="token string">&quot;@@redux/INIT&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * åˆ›å»º store, å‚æ•° reducer, state ä»¥åŠä¸­é—´ä»¶
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> preloadedState<span class="token punctuation">,</span> enhancer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åœ¨å¹³å¸¸çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šçœç•¥ç¬¬äºŒä¸ªå‚æ•°ã€‚æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨reduxä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šåƒç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ä¸€ä¸ªapplyMiddleware()[è¿”å›å€¼æ˜¯ä¸€ä¸ªfunction]ã€‚</span>
  <span class="token comment">// å¦‚æœï¼Œæˆ‘ä»¬æ²¡æœ‰åˆå§‹çŠ¶æ€ï¼Œåˆ™ä¼šçœç•¥ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„å‡½æ•°è°ƒç”¨å½¢å¼ä¸ºï¼š</span>
  <span class="token comment">// const store = createStore(reducer, applyMiddleware(...))</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> preloadedState <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> enhancer <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    enhancer <span class="token operator">=</span> preloadedState<span class="token punctuation">;</span>
    preloadedState <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// å¦‚æœæˆ‘ä»¬æŒ‡å®šäº†reducerå¢å¼ºå™¨enhancer</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> enhancer <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// enhancerå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> enhancer <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expected the enhancer to be a function.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è¿™ä¸ªå‡½æ•°æ¥æ”¶createStoreä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯reducer,preloadedState</span>
    <span class="token comment">// ç›´æ¥è¿”å›ç»è¿‡enhanceråŒ…è£…çš„å¯¹è±¡</span>
    <span class="token keyword">return</span> <span class="token function">enhancer</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> preloadedState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  
  <span class="token comment">// è¦æ±‚ä¼ é€’ç»™createStoreçš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> reducer <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expected the reducer to be a function.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// ä¿å­˜åˆå§‹çš„reducer</span>
  <span class="token keyword">let</span> currentReducer <span class="token operator">=</span> reducer
  <span class="token comment">// ä¿å­˜åˆå§‹çš„state</span>
  <span class="token keyword">let</span> currentState <span class="token operator">=</span> preloadedState
  <span class="token comment">// ä¿å­˜æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨</span>
  <span class="token keyword">let</span> currentListeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// è·å–å½“å‰ç›‘å¬å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ç›¸åŒçš„å¼•ç”¨)</span>
  <span class="token keyword">let</span> nextListeners <span class="token operator">=</span> currentListeners
  <span class="token comment">// æ˜¯å¦æ­£åœ¨æ´¾å‘action</span>
  <span class="token keyword">let</span> isDispatching <span class="token operator">=</span> <span class="token boolean">false</span>

  <span class="token comment">// è¿™ä¸ªå‡½æ•°å¯ä»¥æ ¹æ®å½“å‰ç›‘å¬å‡½æ•°çš„åˆ—è¡¨ç”Ÿæˆæ–°çš„ä¸‹ä¸€ä¸ªç›‘å¬å‡½æ•°åˆ—è¡¨å¼•ç”¨</span>
  <span class="token comment">// å¦‚æœnextListenerså’ŒcurrentListenerså…·æœ‰ç›¸åŒçš„å¼•ç”¨ï¼Œåˆ™è·å–ä¸€ä»½å½“å‰äº‹ä»¶ç›‘å¬å™¨é›†åˆçš„ä¸€ä¸ªå‰¯æœ¬ä¿å­˜åˆ°nextListenersä¸­</span>
  <span class="token keyword">function</span> <span class="token function">ensureCanMutateNextListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextListeners <span class="token operator">===</span> currentListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nextListeners <span class="token operator">=</span> currentListeners<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ä¸ºä»€ä¹ˆè¦ç»´æŠ¤ä¸¤ä»½äº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨(nextListeners,currentListeners)??</span>
  <span class="token comment">// ä¸‹é¢æˆ‘ä»¬æ¥è§£é‡Š</span>

  <span class="token comment">// ç›´æ¥è¿”å›å½“å‰storeçš„state</span>
  <span class="token keyword">function</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> currentState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è®¢é˜…äº‹ä»¶ï¼Œè¿”å›ç§»é™¤è®¢é˜…å‡½æ•°</span>
  <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// äº‹ä»¶ç›‘å¬å™¨å¿…é¡»æ˜¯å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> listener <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expected listener to be a function.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨æ˜¯å¦å·²ç»è¢«å–æ¶ˆçš„æ ‡å¿—</span>
    <span class="token keyword">let</span> isSubscribed <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token comment">// è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ç»“æœå°±æ˜¯ç”Ÿæˆä¸€ä»½å½“å‰äº‹ä»¶ç›‘å¬å™¨çš„ä¸€ä¸ªå‰¯æœ¬ä¿å­˜åˆ°nextListenersä¸­</span>
    <span class="token function">ensureCanMutateNextListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">// å°†æ–°çš„äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ°nextListenersä¸­</span>
    nextListeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
    
    <span class="token comment">// è¿”å›ä¸€ä¸ªå–æ¶ˆç›‘å¬çš„å‡½æ•°</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè¿™ä¸ªç›‘å¬å™¨å·²ç»è¢«å–æ¶ˆäº†ï¼Œåˆ™ç›´æ¥return</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSubscribed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å°†ç›‘å¬å™¨æ˜¯å¦å–æ¶ˆçš„æ ‡å¿—è®¾ç½®ä¸ºfalse</span>
      isSubscribed <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token comment">// å†æ¬¡ç”Ÿæˆä¸€ä»½äº‹ä»¶ç›‘å¬å™¨é›†åˆçš„å‰¯æœ¬</span>
      <span class="token function">ensureCanMutateNextListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// è·å–åˆ°éœ€è¦å–æ¶ˆçš„äº‹ä»¶ç›‘å¬å™¨çš„ç´¢å¼•</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> nextListeners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
      <span class="token comment">// ä»äº‹ä»¶ç›‘å¬å™¨é›†åˆä¸­åˆ é™¤è¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨</span>
      nextListeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ä»subscribeæ–¹æ³•çš„æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡åœ¨è¿›è¡Œç›‘å¬å™¨çš„æ·»åŠ /åˆ é™¤ä¹‹å‰ï¼Œéƒ½ä¼šåŸºäºå½“å‰çš„ç›‘å¬å™¨é›†åˆç”Ÿæˆä¸€ä¸ªå‰¯æœ¬ä¿å­˜åˆ°nextListenersä¸­ã€‚</span>
  <span class="token comment">// ä¸‹é¢æˆ‘ä»¬ç»§ç»­çœ‹dispatchçš„æºç :</span>

  <span class="token comment">// æ‰§è¡Œ reducerï¼Œå¹¶è§¦å‘è®¢é˜…äº‹ä»¶</span>
  <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// https://lodash.com/docs#isPlainObject</span>
    <span class="token comment">// dispatchçš„å‚æ•°å°±æ˜¯æˆ‘ä»¬éœ€è¦æ´¾å‘çš„actionï¼Œä¸€å®šè¦ä¿è¯è¿™ä¸ªactionæ˜¯ä¸€ä¸ªçº¯ç²¹çš„å¯¹è±¡</span>
    <span class="token comment">// å¦‚æœä¸æ˜¯ä¸€ä¸ªçº¯ç²¹çš„å¯¹è±¡ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Actions must be plain objects. &quot;</span> <span class="token operator">+</span>
          <span class="token string">&quot;Use custom middleware for async actions.&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åˆ¤æ–­ action æ˜¯å¦æœ‰ typeï½›å¿…é¡»ï½ å±æ€§</span>
    <span class="token comment">// æ´¾å‘çš„actionå¿…é¡»æœ‰ä¸€ä¸ªtypeå±æ€§(æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå±æ€§è®¤ä¸ºå°±æ˜¯actionçš„èº«ä»½è¯ï¼Œè¿™æ ·reduxæ‰çŸ¥é“ä½ æ´¾å‘çš„æ˜¯å“ªä¸ªactionï¼Œä½ éœ€è¦åšä»€ä¹ˆï¼Œè¯¥æ€ä¹ˆä¸ºä½ åš)</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
        <span class="token string">'Actions may not have an undefined &quot;type&quot; property. '</span> <span class="token operator">+</span>
          <span class="token string">&quot;Have you misspelled a constant?&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¦‚æœæ­£åœ¨ dispatch åˆ™æŠ›å‡ºé”™è¯¯</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isDispatching<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Reducers may not dispatch actions.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¯¹æŠ›å‡º error çš„å…¼å®¹ï¼Œä½†æ— è®ºå¦‚ä½•éƒ½ä¼šç»§ç»­æ‰§è¡Œ isDispatching = false çš„æ“ä½œ</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      isDispatching <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// æ´¾å‘action</span>
      <span class="token comment">// å®è´¨å°±æ˜¯å°†å½“å‰çš„stateå’Œä½ éœ€è¦æ´¾å‘çš„actionä¼ é€’ç»™reducerå‡½æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„state</span>
      currentState <span class="token operator">=</span> <span class="token function">currentReducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      isDispatching <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åˆå¤šäº†ä¸€ä»½äº‹ä»¶ç›‘å¬å™¨çš„åˆ—è¡¨ï¼Œç®€å•çš„è¯´ä¸€ä¸‹è¿™ä¸‰ä»½åˆ—è¡¨çš„ä½œç”¨</span>
    <span class="token comment">// nextListeners: ä¿å­˜è¿™æ¬¡dispatchåï¼Œéœ€è¦è§¦å‘çš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨çš„åˆ—è¡¨</span>
    <span class="token comment">// currentListeners: ä¿å­˜ä¸€ä»½nextListenersåˆ—è¡¨çš„å‰¯æœ¬</span>
    <span class="token comment">// listeners: éœ€è¦æ‰§è¡Œçš„åˆ—è¡¨</span>
    <span class="token keyword">const</span> listeners <span class="token operator">=</span> currentListeners <span class="token operator">=</span> nextListeners
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> listeners<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> listener <span class="token operator">=</span> listeners<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token comment">// è°ƒç”¨æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨</span>
      <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//  dispatchçš„è¿”å›å€¼ä¹Ÿæ˜¯ååˆ†é‡è¦çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªè¿”å›å€¼ï¼Œå°±ä¸å¯èƒ½å¼•å…¥å¼ºå¤§çš„ä¸­é—´ä»¶æœºåˆ¶ã€‚</span>
    <span class="token keyword">return</span> action<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * åŠ¨æ€æ›¿æ¢ reducer
   */</span>
  <span class="token keyword">function</span> <span class="token function">replaceReducer</span><span class="token punctuation">(</span><span class="token parameter">nextReducer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> nextReducer <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expected the nextReducer to be a function.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    currentReducer <span class="token operator">=</span> nextReducer<span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INIT</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INIT</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    dispatch<span class="token punctuation">,</span>
    subscribe<span class="token punctuation">,</span>
    getState<span class="token punctuation">,</span>
    replaceReducer
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br></div></div><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <p><a href="https://segmentfault.com/a/1190000011835213" target="_blank" rel="noopener noreferrer">redux æºç è§£è¯»ï¼ï¼createStore æºç è§£æ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/NiroDu/N-book/edit/master/docs/react/redux_createstore.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘æ­¤é¡µ</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">3/19/2019, 12:35:48 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/n-book/react/react_ssr.html" class="prev">
          ä» 0 å®ç° React SSR
        </a></span> <span class="next"><a href="/n-book/react/react_context.html">
          React Context æ€ä¹ˆç”¨
        </a>
        â†’
      </span></p></div> </div> <!----></div></div>
    <script src="/n-book/assets/js/app.00669d2d.js" defer></script><script src="/n-book/assets/js/24.9323b659.js" defer></script>
  </body>
</html>
